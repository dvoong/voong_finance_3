<html>
  <head>
    <title></title>
    {% load custom_template_tags %}
    {% load static %}
    <link rel="stylesheet" href="{% static 'website/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'website/styles.css' %}">

  </head>
  
  <body>

    <nav id="menu" class="navbar navbar-dark navbar-expand-lg" style="background-color: indianred;">
      <a class="navbar-brand" href="#">Voong Finance</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
	<span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
	<ul class="navbar-nav mr-auto">
	  <li class="nav-item active">
            <a class="nav-link" href="/">Home <span class="sr-only">(current)</span></a>
	  </li>
	  <li class="nav-item">
            <a id="sign-out" class="nav-link" href="sign-out">Sign Out</a>
	  </li>
	</ul>
      </div>
    </nav>

    <div id="balance-chart">
      <svg id="canvas">
	<g id="x-axis"></g>
	<g id="y-axis"></g>
	<g id="plot-area"></g>
      </svg>
    </div>

    <div id="tooltip" class="chart-tooltip" style="opacity: 0;"></div>
    
    <div class="container">

      <div class="row date-navigator-button-container">
	<div class="col-sm">
	  <form id="week-backward-form" action="/home" method="get">
	    <input name="start" value="{{ start_minus_7|date:'Y-m-d' }}" hidden>
	    <input name="end" value="{{ end_minus_7|date:'Y-m-d' }}" hidden>
	    <button id="week-backward-button" type="submit" class="btn btn-primary date-navigator">Back 7 Days</button>
	  </form>
	</div>
	<div class="col-sm">
	  <form id="week-forward-form" action="/home" method="get">
	    <button id="week-forward-button" type="submit" class="btn btn-primary date-navigator">Forward 7 Days</button>
	    <input name="start" value="{{ start_plus_7|date:'Y-m-d' }}" hidden>
	    <input name="end" value="{{ end_plus_7|date:'Y-m-d' }}" hidden>
	  </form>
	</div>
      </div>
      
      <form id="date-selector" action="/home" method="get">
	<h2>Select date range</h2>
	<div class="form-group row">
	  <label for="start-input" class="col-sm-2 col-form-label">Start</label>
	  <div class="col-sm-10">
	    <input id="start-input" type="date" name="start" class="form-control" value="{{start|date:'Y-m-d'}}">
	  </div>
	</div>
	<div class="form-group row">
	  <label for="end-input" class="col-sm-2 col-form-label">End</label>
	  <div class="col-sm-10">
	    <input id="end-input" type="date" name="end" class="form-control" value="{{end|date:'Y-m-d'}}">
	  </div>
	</div>
	<input type="submit" class="btn btn-primary" value="Submit">
      </form>
      
      <div id="transaction-list-container">
	<h2>Transactions</h2>

	<form id="transaction-form" class="form" action="/create-transaction" method="post" style="border: none";>{% csrf_token %}	    
	</form>
	
	<table id="transaction-list" class="table">
	  <tr class="table-header">
	    <th id="date-header">Date</th>
	    <th id="transaction-size-header">Transaction Size</th>
	    <th id="description-header">Description</th>
	    <th id="closing-balance-header" colspan="3">Balance</th>
	  </tr>

	  <tr>
	    <td>
	      <input id="date-input"
		     type="date"
		     name="date"
		     class="form-control"
		     value="{{today|date:'Y-m-d'}}"
		     form="transaction-form">
	    </td>
	    <td>
	      <input id="transaction-size-input"
		     type="number" step="0.01"
		     name="size"
		     class="form-control"
		     form="transaction-form" required>
	    </td>
	    <td>
	      <input id="description-input"
		     name="description"
		     class="form-control"
		     form="transaction-form">
	    </td>
	    <td></td>
	    <td colspan="2">
	      <input id="submit-button"
		     type="submit"
		     class="btn btn-primary"
		     style="width: 100%"
		     value="Create Transaction"
		     form="transaction-form">

	      <div class="dropdown">
		<select id="repeat-options"
			class="btn btn-secondary dropdown-toggle btn--width-100"
			name="repeat_status"
			form="transaction-form">
		  <option value="does_not_repeat">Does not repeat</option>
		  <option value="daily">Daily</option>
		  <option value="weekly">Weekly</option>
		  <option value="monthly">Monthly</option>
		</select>
	      </div>
	      
	    </td>
	  </tr>
	  
	  {% for t in transactions %}
	  <tr class="transaction">
	    <form id="transaction-modify-form"
		  action="/modify-transaction"
		  method="post">{% csrf_token %}
	      <td class="transaction-date">
		<input class="date-input form-control"
		       type="date"
		       name="date"
		       value="{{t.date|date:'Y-m-d'}}">
	      </td>
	      <td class="transaction-size">
		<input class="transaction-size-input form-control"
		       type="number"
		       step="0.01"
		       name="size"
		       value="{{t.size}}">
	      </td>
	      <td class="transaction-description">
		<input class="description-input form-control"
		       name="description"
		       value="{{t.description}}">
	      </td>
	      <td class="transaction-balance">
		<span class="form-control">{{t.closing_balance|to_currency}}</span>
	      </td>
	      <td>
		<input class="save-transaction-button btn btn-primary"
		       type="submit"
		       name="action"
		       value="update">
	      </td>
	      <td>
		<input class="delete-transaction-button btn btn-primary"
		       type="submit"
		       name="action"
		       value="delete">
	      </td>
	      <input class="id" name="id" type="hidden" value="{{t.id}}">
	    </form>
	  </tr>
	  {% endfor %}
	</table>
      </div>

      <script>
	transactions = [
	{% for t in transactions %}
	{
	date: "{{t.date|date:'Y-m-d'}}",
	size: {{t.size}},
	description: "{{t.description}}",
	closing_balance: {{t.closing_balance}}
	},
	{% endfor %}
	]
      </script>

      <script>
	balances = [
	{% for b in balances %}
	{
	date: "{{b.date}}",
	balance: {{b.balance}},
	},
	{% endfor %}
	]
      </script>

      <script src="{% static "website/home.js" %}" type="text/javascript"></script>

    </div>
  </body>
</html>
