<html>
  <head>
    <title></title>
    {% load custom_template_tags %}
    {% load static %}
    <link rel="stylesheet" href="{% static 'website/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'website/styles.css' %}">
    <link rel="icon" 
	  type="image/x-icon"
	  href="{% static 'website/favicon.ico' %}" />
  </head>
  
  <body>

    <nav id="menu"
	 class="navbar navbar-dark navbar-expand-lg"
	 style="background-color: indianred;">
      <a class="navbar-brand" href="#">Voong Finance</a>
      <button class="navbar-toggler"
	      type="button"
	      data-toggle="collapse"
	      data-target="#navbarSupportedContent"
	      aria-controls="navbarSupportedContent"
	      aria-expanded="false"
	      aria-label="Toggle navigation">
	<span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
	<ul class="navbar-nav mr-auto">
	  <li class="nav-item active">
            <a class="nav-link" href="/">Home <span class="sr-only">(current)</span></a>
	  </li>
	  <li class="nav-item">
            <a id="sign-out" class="nav-link" href="sign-out">Sign Out</a>
	  </li>
	</ul>
      </div>
    </nav>

    <div id="balance-chart">
      <svg id="canvas">
	<g id="x-axis"></g>
	<g id="y-axis"></g>
	<g id="plot-area"></g>
      </svg>
    </div>

    <div id="tooltip" class="chart-tooltip" style="opacity: 0;"></div>
    
    <div class="container">

      <div class="row date-navigator-button-container">

	<div class="col-sm">
	  <form id="week-backward-form" action="/home" method="get">
	    <input name="start" value="{{ start_minus_7|date:'Y-m-d' }}" hidden>
	    <input name="end" value="{{ end_minus_7|date:'Y-m-d' }}" hidden>
	    <button id="week-backward-button"
		    type="submit"
		    class="btn btn-primary date-navigator">
	      Back 7 Days
	    </button>
	  </form>
	</div>
	
	<div class="col-sm">
	  <form id="center-on-today-form">
	    <input name="start" value="{{ center_on_today_start|date:'Y-m-d' }}" hidden>
	    <input name="end" value="{{ center_on_today_end|date:'Y-m-d' }}" hidden>
	    <button id="center-on-today-button"
		    type="submit"
		    class="btn btn-primary date-navigator">
	      Today
	    </button>
	    
	  </form>
	</div>
	
	<div class="col-sm">
	  <form id="week-forward-form" action="/home" method="get">
	    <button id="week-forward-button"
		    type="submit"
		    class="btn btn-primary date-navigator">
	      Forward 7 Days
	    </button>
	    <input name="start" value="{{ start_plus_7|date:'Y-m-d' }}" hidden>
	    <input name="end" value="{{ end_plus_7|date:'Y-m-d' }}" hidden>
	  </form>
	</div>
	
      </div>
      
      <form id="date-selector" action="/home" method="get">
	<h2>Select date range</h2>
	<div class="form-group row">
	  <label for="start-input" class="col-sm-2 col-form-label">Start</label>
	  <div class="col-sm-10">
	    <input id="start-input" type="date" name="start" class="form-control" value="{{start|date:'Y-m-d'}}">
	  </div>
	</div>
	<div class="form-group row">
	  <label for="end-input" class="col-sm-2 col-form-label">End</label>
	  <div class="col-sm-10">
	    <input id="end-input" type="date" name="end" class="form-control" value="{{end|date:'Y-m-d'}}">
	  </div>
	</div>
	<input type="submit" class="btn btn-primary" value="Submit">
      </form>
      
      <div id="transaction-list-container" class="container">
	<h2>Transactions</h2>

	<form id="transaction-form" class="form" action="/create-transaction" method="post" style="border: none";>{% csrf_token %}
	  <input id="start-input"
		 type="date"
		 name="start"
		 class="form-control"
		 value="{{start|date:'Y-m-d'}}"
		 hidden>
	  <input id="end-input"
		 type="date"
		 name="end"
		 class="form-control"
		 value="{{end|date:'Y-m-d'}}"
		 hidden>
	  
	</form>

	<!-- The Modal -->
	<div class="modal fade" id="myModal">
	  <div class="modal-dialog">
	    <div class="modal-content">

	      <!-- Modal Header -->
	      <div class="modal-header">
		<h4 class="modal-title">Reapeat transaction ends</h4>
		<button type="button" class="close" data-dismiss="modal">&times;</button>
	      </div>

	      <!-- Modal body -->
	      <div id="repeat-options-div" class="modal-body">

		<select
		  id="frequency-input"
		  class="dropdown"
		  form="transaction-form"
		  name="frequency">
		  <option value="daily">Daily</option>
		  <option value="weekly" selected>Weekly</option>
		  <option value="monthly">Monthly</option>
		  <option value="yearly">Yearly</option>
		</select>
		
		<div class="for-check row" style="padding: 5px 5px 5px 15px">
		  <div class="col-sm-6">
		  <input class="form-check-input"
			 type="radio"
			 id="never-ends"
			 name="end_condition"
			 value="never_ends"
			 form="transaction-form"
			 checked>
		  <label class="form-check-label" for="never-ends">
		    Never ends
		  </label>
		  </div>
		</div>

		<div class="for-check row" style="padding: 5px 5px 5px 15px">
		  <div class="col-sm-6">
		    <input class="form-check-input"
		    	   type="radio"
			   name="end_condition"
			   value="n_occurrences"
		    	   id="ends-after-n-occurrences"
			   form="transaction-form">
		    <label class="form-check-label" for="ends-after-n-occurrences">
		      Ends after # transactions
		    </label>
		  </div>
		  <div class="col-sm-6">
		    <input id="n-occurrences-input"
			   class="form-control"
			   type="number"
			   step="1"
			   value="1"
			   name="n_occurrences"
			   form="transaction-form"
			   disabled>
		  </div>
		</div>
		
		<div class="for-check row" style="padding: 5px 5px 5px 15px">
		  <div class="col-sm-6">
		  <input class="form-check-input"
			 type="radio"
			 id="ends-on-date"
			 name="end_condition"
			 value="ends_on_date"
			 form="transaction-form">
		  <label class="form-check-label" for="ends-on-date">
		    Ends on
		  </label>
		  </div>
		  <div class="col-sm-6">
		    <input id="ends-on-date-input"
			   class="form-control"
			   type="date"
			   value="{{today|date:'Y-m-d'}}"
			   name="end_date"
			   form="transaction-form"
			   disabled>
		  </div>
		</div>
		
	      </div>

	      <!-- Modal footer -->
	      <div class="modal-footer">
		<button id="repeat-options-close-button"
			type="button"
			class="btn btn-danger"
			data-dismiss="modal">Close</button>
	      </div>

	    </div>
	  </div>
	</div>

	<table id="transaction-list" class="table">
	  <thead>
	    <tr class="table-header">
	      <th id="date-header">Date</th>
	      <th id="transaction-size-header">Transaction Size</th>
	      <th id="description-header">Description</th>
	      <th id="closing-balance-header" colspan="3">Balance</th>
	    </tr>
	  </thead>
	  
	  <tbody>
	    <tr>
	      <td>
	  	<input id="date-input"
	  	       type="date"
	  	       name="date"
	  	       class="form-control"
	  	       value="{{today|date:'Y-m-d'}}"
	  	       form="transaction-form">
	      </td>
	      <td>
		<input id="transaction-size-input"
	  	       type="number" step="0.01"
	  	       name="size"
	  	       class="form-control"
	  	       form="transaction-form" required>
	      </td>
	      <td>
	  	<input id="description-input"
	  	       name="description"
	  	       class="form-control"
	  	       form="transaction-form">
	      </td>
	      <td></td>
	      <td colspan="2">
	  	<input id="submit-button"
	  	       type="submit"
	  	       class="btn btn-primary"
	  	       style="width: 100%"
	  	       value="Create Transaction"
	  	       form="transaction-form">
		
		<div class="form-check">
		  <input class="form-check-input"
			 type="checkbox"
			 value="does_not_repeat"
			 name="repeat_status"
			 id="repeat-checkbox"
			 form="transaction-form">
		  <label class="form-check-label" for="repeat-checkbox">
		    Repeats
		  </label>

		</div>
		
	      </td>
	    </tr>
	  </tbody>
	</table>
      </div>

      <script>
	transactions = {{ transactions | safe }};
      </script>

      <script>
	balances = [
	{% for b in balances %}
	{
	date: "{{b.date}}",
	balance: {{b.balance}},
	},
	{% endfor %}
	]
      </script>

      <script>
	csrf_token = '{{ csrf_token }}'
      </script>

      <script src="{% static "website/home.js" %}" type="text/javascript"></script>

    </div>
  </body>
</html>
