!function r(o,s,c){function d(n,t){if(!s[n]){if(!o[n]){var a="function"==typeof require&&require;if(!t&&a)return a(n,!0);if(p)return p(n,!0);var e=new Error("Cannot find module '"+n+"'");throw e.code="MODULE_NOT_FOUND",e}var i=s[n]={exports:{}};o[n][0].call(i.exports,function(t){var a=o[n][1][t];return d(a||t)},i,i.exports,r,o,s,c)}return s[n].exports}for(var p="function"==typeof require&&require,t=0;t<c.length;t++)d(c[t]);return d}({1:[function(t,a,n){"use strict";n.__esModule=!0;var e=function(){function t(t){this.selection=t,this.scale=d3.scaleUtc()}return t.prototype.set_range=function(t){this.scale.range(t)},t.prototype.set_domain=function(t){this.scale.domain(t)},t.prototype.set_position=function(t){this.position=t},t.prototype.draw=function(){var t=new Date,a=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),n=this.position[0],e=this.position[1],i=this.scale;this.selection.attr("transform","translate("+n+", "+e+")"),this.selection.transition().call(d3.axisBottom(i)),this.selection.selectAll("g.tick text").filter(function(t){return t.getTime()==a.getTime()}).attr("fill","blue")},t}();n.XAxis=e;var i=function(){function t(t){this.selection=t,this.scale=d3.scaleLinear()}return t.prototype.set_range=function(t){this.scale.range(t)},t.prototype.set_domain=function(t){this.scale.domain(t)},t.prototype.set_position=function(t){this.position=t},t.prototype.draw=function(){var t=this.position[0],a=this.position[1],n=this.scale;this.selection.attr("transform","translate("+t+", "+a+")"),this.selection.transition().call(d3.axisLeft(n).tickFormat(function(t){return"£"+t.toLocaleString(void 0,{maximumFractionDigits:2,minimumFractionDigits:2})}))},t}();n.YAxis=i},{}],2:[function(t,a,n){"use strict";n.__esModule=!0;var e=t("./canvas"),i=t("./tooltip"),r=t("./axis"),l=new i.ToolTip,o=function(){function t(t,a,n){void 0===n&&(n={top:10,left:60,right:20,bottom:40}),this.selection=t,this.balances=a,this.padding=n,this.canvas=new e.Canvas(this.selection.select("#canvas")),this.plot_area=this.canvas.selection.select("#plot-area"),this.x_axis=new r.XAxis(this.canvas.selection.select("#x-axis")),this.y_axis=new r.YAxis(this.canvas.selection.select("#y-axis")),this.set_x_axis_position(),this.set_x_axis_range(),this.set_x_axis_domain(),this.set_y_axis_position(),this.set_y_axis_range(),this.set_y_axis_domain()}return t.prototype.resize=function(){this.canvas.width=this.canvas.get_width(),this.canvas.height=this.canvas.get_height(),this.set_x_axis_range(),this.set_x_axis_domain(),this.set_y_axis_range(),this.set_y_axis_domain(),this.draw()},t.prototype.set_x_axis_position=function(t){var a=this.padding,n=this.canvas.height;void 0===t&&(t=[a.left,n-a.bottom]),this.x_axis.set_position(t)},t.prototype.set_x_axis_range=function(t){void 0===t&&(t=[0,this.canvas.width-this.padding.left-this.padding.right]),this.x_axis.set_range(t)},t.prototype.set_x_axis_domain=function(t){void 0===t&&(t=this.get_x_domain()),this.x_axis.set_domain(t)},t.prototype.set_y_axis_position=function(t){var a=this.padding;void 0===t&&(t=[a.left,a.top]),this.y_axis.set_position(t)},t.prototype.set_y_axis_range=function(t){void 0===t&&(t=[this.canvas.height-this.padding.top-this.padding.bottom,0]),this.y_axis.set_range(t)},t.prototype.set_y_axis_domain=function(t){void 0===t&&(t=this.get_y_domain()),this.y_axis.set_domain(t)},t.prototype.draw=function(){this.draw_x_axis(),this.draw_y_axis(),this.draw_bars()},t.prototype.get_x_domain=function(){var t=new Date(Date.parse(d3.min(this.balances,function(t){return t.date}))),a=new Date(Date.parse(d3.max(this.balances,function(t){return t.date})));return t.setDate(t.getDate()-.5),a.setDate(a.getDate()+.5),[t,a]},t.prototype.get_y_domain=function(){var t=d3.min(this.balances,function(t){return t.balance}),a=d3.max(this.balances,function(t){return t.balance});return[0<t?.9*t:1.1*t,0<a?1.1*a:.9*a]},t.prototype.draw_x_axis=function(){this.x_axis.draw()},t.prototype.draw_y_axis=function(){this.y_axis.draw()},t.prototype.draw_bars=function(){var a=null,n=this.x_axis.scale,e=this.y_axis.scale,i=this.padding,t=this.balances,r=this.canvas.width,o=this.plot_area,s=new Date,c=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate()));function d(t){var a=new Date(t.date);return a.setDate(a.getDate()-.45),i.left+n(a)}function p(t){return 0<=t.balance?i.top+e(t.balance):i.top+a}function u(t){return Math.abs(e(t.balance)-a)}a=e.domain()[0]<0&&0<=e.domain()[1]?e(0):e.domain()[0]<0?e.range()[1]:e.range()[0],o.selectAll(".bar").data(t,function(t){return t.date}).transition().attr("x",d).attr("width",.9*(r-i.left-i.right)/t.length).attr("y",p).attr("height",u),o.selectAll(".bar").data(t,function(t){return t.date}).enter().append("rect").attr("class",function(t){return t.date==c.toISOString().slice(0,10)?"bar bar-today":"bar"}).attr("x",d).attr("y",i.top+a).attr("width",.9*(r-i.left-i.right)/t.length).attr("date",function(t){return t.date}).attr("balance",function(t){return t.balance}).on("mouseover",l.mouseover_callback).on("mouseout",l.mouseout_callback).transition().attr("y",p).attr("height",u),o.selectAll(".bar").data(t,function(t){return t.date}).exit().transition().attr("x",d).attr("width",.9*(r-i.left-i.right)/t.length).attr("y",a).attr("height",0).remove()},t}();n.BalanceChart=o},{"./axis":1,"./canvas":3,"./tooltip":5}],3:[function(t,a,n){"use strict";n.__esModule=!0;var e=function(){function t(t){this.selection=t,this.height=this.get_height(),this.width=this.get_width()}return t.prototype.get_width=function(){return parseInt(this.selection.style("width"))},t.prototype.get_height=function(){return parseInt(this.selection.style("height"))},t}();n.Canvas=e},{}],4:[function(t,a,n){"use strict";n.__esModule=!0,console.log("home.js"),console.log("test7");var e=t("./balance_chart"),i=t("./transactions_table"),u=null,l=null;function f(t){return t.toISOString().slice(0,10)}function r(t,a){var p=a.serializeArray();t.preventDefault(),console.log("move_date_range_callback"),$.get("/get-balances",p,function(t){console.log("success");var a=p[0].value,n=p[1].value;balances=t.data.balances,u.balances=balances,u.resize();var e=$("#date-selector");e.find("#start-input").val(a),e.find("#end-input").val(n);var i=$("#week-forward-form"),r=new Date(a),o=new Date(n);r.setDate(r.getDate()+7),o.setDate(o.getDate()+7);var s=i.find('input[name="start"]'),c=i.find('input[name="end"]');s.val(f(r)),c.val(f(o));var d=$("#week-backward-form");r=new Date(a),o=new Date(n),r.setDate(r.getDate()-7),o.setDate(o.getDate()-7),s=d.find('input[name="start"]'),c=d.find('input[name="end"]'),s.val(f(r)),c.val(f(o)),transactions=t.data.transactions,l.transactions=transactions,l.update()})}$(document).ready(function(){(u=new e.BalanceChart(d3.select("#balance-chart"),balances)).draw(),l=new i.TransactionsTable(d3.select("#transaction-list"),transactions),$("#week-forward-form").on("submit",function(t){r(t,$(this))}),$("#week-backward-form").on("submit",function(t){r(t,$(this))}),$("#center-on-today-form").on("submit",function(t){r(t,$(this))}),$(window).resize(function(){u.resize()}),$("#repeat-checkbox").change(function(t){$(this).prop("checked")?$("#repeat-options-modal").modal("show"):$(this).val("does_not_repeat")}),$("#repeat-options-close-button").click(function(t){$("#repeat-checkbox").prop("checked",!1)}),$('input:radio[name="ends_how"]').change(function(t){"ends-after-n-transactions"==$(this).attr("id")?($("#n-transactions-input").prop("disabled",!1),$("#ends-on-date-input").prop("disabled",!0)):"ends-on-date"==$(this).attr("id")?($("#n-transactions-input").prop("disabled",!0),$("#ends-on-date-input").prop("disabled",!1)):($("#n-transactions-input").prop("disabled",!0),$("#ends-on-date-input").prop("disabled",!0))}),$("form.repeat-transaction-update-form").submit(function(t){var a=$(this),n=$("#date-selector input[name='start']").val();a.append('<input name="start" value="'+n+'" hidden>');var e=$("#date-selector input[name='end']").val();a.append('<input name="end" value="'+e+'" hidden>')}),$("form#transaction-form").submit(function(t){var a=$(this),n=$("#date-selector input[name='start']").val();a.append('<input name="start" value="'+n+'" hidden>');var e=$("#date-selector input[name='end']").val();a.append('<input name="end" value="'+e+'" hidden>')})})},{"./balance_chart":2,"./transactions_table":6}],5:[function(t,a,n){"use strict";n.__esModule=!0,n.ToolTip=function(){var e=this;this.tooltip=d3.select("#tooltip"),this.mouseover_callback=function(t){e.tooltip.transition().duration(200).style("opacity",.9),e.tooltip.style("opacity",1),e.tooltip.html("<b>"+t.date+"</b><br>£"+t.balance.toFixed(2)).style("left",function(t){var a=parseFloat(e.tooltip.style("width")),n=parseFloat(d3.event.pageX);return parseFloat(d3.select("#canvas").style("width"))<n+a&&(n-=1.1*a),n+"px"}).style("top",d3.event.pageY-28+"px"),d3.select(this).style("opacity",.6)},this.mouseout_callback=function(t){e.tooltip.transition().duration(500).style("opacity",0),d3.select(this).style("opacity",1)}}},{}],6:[function(t,a,n){"use strict";function u(t,a){t.find("input").attr("form",a.attr("id")),t.find('button[type="submit"]').attr("form",a.attr("id")),t.modal("show")}function i(t){var a=$(this),n='input[form="'+a.attr("id")+'"][name="repeat_transaction_id"]',e=$(n).val(),i=$(document.activeElement),r=(n='input[form="'+a.attr("id")+'"][name="date"]',$(n).val()),o=(n='input[form="'+a.attr("id")+'"][name="transaction_date_original"]',$(n).val()),s=(n='input[form="'+a.attr("id")+'"][name="size"]',$(n).val(),n='input[form="'+a.attr("id")+'"][name="transaction_size_original"]',$(n).val(),n='input[form="'+a.attr("id")+'"][name="description"]',$(n).val(),n='input[form="'+a.attr("id")+'"][name="transaction_description_original"]',$(n).val(),r!=o);if(-1!=i.attr("class").indexOf("delete-transaction-button")&&""!=e)d3.event.preventDefault(),0===(c=$("#repeat-transaction-deletion-prompt")).length?$.get("/html-snippets/repeat-transaction-deletion-prompt",function(t){$("body").append(t),u(c=$("#repeat-transaction-deletion-prompt"),a)}):u(c,a);else if(-1!=i.attr("class").indexOf("save-transaction-button")&&""!=e&&1!=s){var c;d3.event.preventDefault(),0===(c=$("#repeat-transaction-update-prompt")).length?$.get("/html-snippets/repeat-transaction-update-prompt",function(t){$("body").append(t),u(c=$("#repeat-transaction-update-prompt"),a)}):u(c,a)}else{var d=$("#date-selector #start-input").attr("value"),p=$("#date-selector #end-input").attr("value");a.append('<input name="start" value="'+d+'">'),a.append('<input name="end" value="'+p+'">')}}n.__esModule=!0;var e=function(){function t(t,a){this.selection=t,this.transactions=a,this.update()}return t.prototype.update=function(){var t,a=this.selection.selectAll(".transaction").data(this.transactions,function(t){return t.date+"_"+t.index}),n=a.enter().append("tr").attr("class","transaction"),e=n.append("form").attr("id",function(t){return"transaction-modify-form-"+t.id}).attr("action","/modify-transaction").attr("method","post").attr("hidden",!0);e.append("input").attr("hidden",!0).attr("name","csrfmiddlewaretoken").attr("value",csrf_token),e.on("submit",i),(t=n.append("td")).append("input").attr("class","transaction-date date-input form-control").attr("type","date").attr("name","date").attr("value",function(t){return t.date}).attr("form",function(t){return"transaction-modify-form-"+t.id}),t.append("input").attr("hidden",!0).attr("name","transaction_date_original").attr("value",function(t){return t.date}).attr("form",function(t){return"transaction-modify-form-"+t.id}),(t=n.append("td")).append("input").attr("class","transaction-size transaction-size-input form-control").attr("type","number").attr("step","0.01").attr("name","size").attr("value",function(t){return t.size}).attr("form",function(t){return"transaction-modify-form-"+t.id}),t.append("input").attr("hidden",!0).attr("name","transaction_size_original").attr("value",function(t){return t.size}).attr("form",function(t){return"transaction-modify-form-"+t.id}),(t=n.append("td")).append("input").attr("class","transaction-description description-input form-control").attr("name","description").attr("form",function(t){return"transaction-modify-form-"+t.id}).attr("value",function(t){return t.description}),t.append("input").attr("hidden",!0).attr("name","transaction_description_original").attr("value",function(t){return t.description}).attr("form",function(t){return"transaction-modify-form-"+t.id}),n.append("td").append("span").attr("class","transaction-balance balance-input form-control").attr("name","balance").attr("form",function(t){return"transaction-modify-form-"+t.id}).html(function(t){return"£"+t.closing_balance.toLocaleString(void 0,{maximumFractionDigits:2,minimumFractionDigits:2})}),n.append("td").append("input").attr("class","save-transaction-button btn btn-primary").attr("type","submit").attr("name","action").attr("form",function(t){return"transaction-modify-form-"+t.id}).attr("value","update"),n.append("td").append("button").attr("class","delete-transaction-button btn btn-primary").attr("form",function(t){return"transaction-modify-form-"+t.id}).attr("type","submit").attr("name","action").attr("value","delete").html("Delete"),n.append("input").attr("class","id").attr("name","id").attr("type","hidden").attr("form",function(t){return"transaction-modify-form-"+t.id}).attr("value",function(t){return t.id}),n.append("input").attr("class","repeat-transaction-id").attr("name","repeat_transaction_id").attr("type","hidden").attr("form",function(t){return"transaction-modify-form-"+t.id}).attr("value",function(t){return t.repeat_transaction_id}),a.exit().remove()},t}();n.TransactionsTable=e},{}]},{},[4]);
//# sourceMappingURL=home.js.map
